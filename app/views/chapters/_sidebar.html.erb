<div class="sidebar">
  <h4><%= link_to "Course Main Page", chapters_path %></h4>

  <% sections = chapters.sort_by(&:id).to_a.map { |c| c.section }.uniq %>

  <% sections.each_with_index do |section, index| %>
    <h4><%= "#{index+1}. #{section}" %></h4>

    <% subchapters = (chapters.select { |c| c.section == section }).sort_by(&:id) %>

    <% subchapters.each do |subchapter| %>
      <h5><%= link_to "#{subchapter.title}", chapter_path(subchapter), 'data-no-turbolink' => true %></h5>
    <% end %>
  <% end %>
</div>

<% if current_user.try(:admin?) %>
  <br>
  <%= link_to 'New Chapter', new_chapter_path, class: "btn btn-primary" %>
<% end %>